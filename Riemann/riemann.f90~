*
IMPLICIT NONE
!*
!C Declaration of variables:
!*
INTEGER I, CELLS

REAL  GAMMA, G1, G2, G3, G4, G5, G6, G7, G8,
&     DL, UL, PL, CL, DR, UR, PR, CR,
&     DIAPH, DOMLEN, DS, DX, PM, MPA, PS, S,
&     TIMEOUT, UM, US, XPOS

COMMON /GAMMAS/ GAMMA, G1, G2, G3, G4, G5, G6, G7, G8
COMMON /STATES/ DL, UL, PL, CL, DR, UR, PR, CR

OPEN(UNIT = 1,FILE = ’exact.ini’,STATUS = ’UNKNOWN’)
!*
!C Initial data and parameters are read in
!
READ(1,*)DOMLEN  !Domain length
READ(1,*)DIAPH   !Initial discoontinuity position 
READ(1,*)CELLS   !Number of computing cells
READ(1,*)GAMMA   !Ratio of specific heats
READ(1,*)TIMEOUT !Output time
READ(1,*)DL      !Initial density on left state
READ(1,*)UL      !Initial velocity on left state
READ(1,*)PL      !Initial pressure on left state
READ(1,*)DR      !Initial density on right state
READ(1,*)UR      !Initial velocity on right state
READ(1,*)PR      !Initial pressure on right state
READ(1,*)MPA     !Normalisisng constant

CLOSE(1)
!*
!C Compute gamma related constants
!
G1 = (GAMMA - 1.0)/(2.0*GAMMA)
G2 = (GAMMA + 1.0)/(2.0*GAMMA)
G3 = 2.0*GAMMA/(GAMMA - 1.0)
G4 = 2.0/(GAMMA - 1.0)
G5 = 2.0/(GAMMA + 1.0)
G6 = (GAMMA - 1.0)/(GAMMA + 1.0)
G7 = (GAMMA - 1.0)/2.0
G8 = GAMMA - 1.0
!*
!C Compute sound speeds
!*

CL = SQRT(GAMMA*PL/DL)
CR = SQRT(GAMMA*PR/DR)

!*
!C  The pressure positivity condition is tested for
!
IF(G4*(CL+CR).LE.(UR-UL))THEN
   !The initial data is such that vacuum is generated.
   !Program stopped.
   WRITE(6,*)
   WRITE(6,*)’***Vacuum is generated by data***’
   WRITE(6,*)’***Program stopped***’
   WRITE(6,*)

   STOP
ENDIF

!Exact solution for pressure and velocity in star
!region is found
CALL STARPU(PM, UM, MPA)

DX = DOMLEN/REAL(CELLS)

!Complete solution at time TIMEOUT is found
OPEN(UNIT = 2,FILE = ’exact.out’,STATUS = ’UNKNOWN’)

DO 10 I = 1, CELLS
   XPOS = (REAL(I) - 0.5)*DX
   S = (XPOS - DIAPH)/TIMEOUT

   !Solution at point (X,T) = ( XPOS - DIAPH,TIMEOUT)
   !is found
   CALL SAMPLE(PM, UM, S, DS, US, PS)
   !Exact solution profiles are written to exact.out.
   WRITE(2, 20)XPOS, DS, US, PS/MPA, PS/DS/G8/MPA

10 CONTINUE

   CLOSE(2)

20 FORMAT(5(F14.6, 2X))

END DO
